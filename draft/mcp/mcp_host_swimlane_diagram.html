<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>风雪围城</title>

  
  <meta name="author" content="YueGS">
  

  
  <meta name="description" content="完整MCP交互场景：从握手到执行
    
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
       ">
  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="风雪围城"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="风雪围城" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">风雪围城</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/categories">Categories</a></li>
      
        <li><a href="/tags">Tags</a></li>
      
        <li><a href="/about">About</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span></span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/draft/mcp/mcp_host_swimlane_diagram.html" rel="bookmark">
        <time class="entry-date published" datetime="2025-06-11T15:04:41.687Z">
          2025-06-11
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>完整MCP交互场景：从握手到执行</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, '微软雅黑', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }

        .comic-container {
            max-width: 1500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .comic-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .comic-header h1 {
            font-size: 42px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .comic-header p {
            font-size: 20px;
            opacity: 0.9;
        }

        .phase-selector {
            background: #ecf0f1;
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .phase-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .phase-btn.active {
            background: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .complete-scene {
            padding: 40px;
            background: #f8f9fa;
        }

        .phase-container {
            display: none;
        }

        .phase-container.active {
            display: block;
        }

        .phase-title {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .conversation-flow {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .dialogue-step {
            background: white;
            border: 4px solid #2c3e50;
            border-radius: 20px;
            padding: 25px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: slideIn 0.6s ease-out;
        }

        .step-number {
            position: absolute;
            top: -20px;
            left: 30px;
            background: #e74c3c;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .dialogue-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            align-items: start;
        }

        .character {
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            position: relative;
        }

        .character-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 45px;
            border: 5px solid #2c3e50;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            position: relative;
        }

        .user-avatar { background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; }
        .host-avatar { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .llm-avatar { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; }
        .dev-server-avatar { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .data-server-avatar { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; }
        .cloud-server-avatar { background: linear-gradient(135deg, #1abc9c, #16a085); color: white; }
        .tool-avatar { background: linear-gradient(135deg, #95a5a6, #7f8c8d); color: white; }

        .character-name {
            font-weight: bold;
            margin-top: 15px;
            color: #2c3e50;
            font-size: 16px;
            text-align: center;
        }

        .speech-bubble {
            background: white;
            border: 4px solid #2c3e50;
            border-radius: 25px;
            padding: 20px;
            position: relative;
            max-width: 380px;
            margin: 15px 15px 20px 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            font-size: 15px;
            line-height: 1.4;
        }

        .speech-bubble::before {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 20px solid #2c3e50;
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -14px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 16px solid transparent;
            border-right: 16px solid transparent;
            border-top: 16px solid white;
        }

        .host-bubble { background: linear-gradient(135deg, #e6f3ff, #bfdbfe); border-color: #3b82f6; }
        .host-bubble::before { border-top-color: #3b82f6; }
        .host-bubble::after { border-top-color: #e6f3ff; }

        .dev-server-bubble { background: linear-gradient(135deg, #fef2f2, #fecaca); border-color: #ef4444; }
        .dev-server-bubble::before { border-top-color: #ef4444; }
        .dev-server-bubble::after { border-top-color: #fef2f2; }

        .data-server-bubble { background: linear-gradient(135deg, #fffbeb, #fef3c7); border-color: #f59e0b; }
        .data-server-bubble::before { border-top-color: #f59e0b; }
        .data-server-bubble::after { border-top-color: #fffbeb; }

        .cloud-server-bubble { background: linear-gradient(135deg, #ecfdf5, #d1fae5); border-color: #10b981; }
        .cloud-server-bubble::before { border-top-color: #10b981; }
        .cloud-server-bubble::after { border-top-color: #ecfdf5; }

        .llm-bubble { background: linear-gradient(135deg, #f3e8ff, #ddd6fe); border-color: #8b5cf6; }
        .llm-bubble::before { border-top-color: #8b5cf6; }
        .llm-bubble::after { border-top-color: #f3e8ff; }

        .tool-bubble { background: linear-gradient(135deg, #f8fafc, #e2e8f0); border-color: #64748b; }
        .tool-bubble::before { border-top-color: #64748b; }
        .tool-bubble::after { border-top-color: #f8fafc; }

        .thinking-bubble {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 3px dashed #0ea5e9;
            font-style: italic;
        }

        .code-snippet {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            border-left: 4px solid #00ff00;
            overflow-x: auto;
        }

        .protocol-details {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
        }

        .status-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            border: 2px solid white;
        }

        .connecting { background: #ff9800; color: white; animation: pulse 1.5s infinite; }
        .negotiating { background: #2196f3; color: white; animation: spin 1s linear infinite; }
        .working { background: #e74c3c; color: white; animation: spin 1s linear infinite; }
        .done { background: #27ae60; color: white; }

        .emotion {
            position: absolute;
            top: -15px;
            right: -15px;
            font-size: 25px;
            animation: bounce 2s infinite;
        }

        .data-flow-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            font-size: 30px;
            color: #3498db;
            animation: pulse 2s infinite;
        }

        .timeline-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }

        .control-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #2980b9;
            transform: translateY(-3px);
        }

        .detail-note {
            background: #f8f9fa;
            border-left: 5px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-size: 13px;
            color: #555;
        }

        .multi-server-grid {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 30px;
            align-items: start;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .connection-status {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .server-status {
            background: #ecf0f1;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .server-status.connected { background: #d5f4e6; color: #27ae60; }
        .server-status.connecting { background: #fff3cd; color: #856404; }
        .server-status.failed { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="comic-container">
        <div class="comic-header">
            <h1>🎬 完整MCP交互场景</h1>
            <p>从系统启动协商到用户请求执行的完整流程</p>
        </div>

        <div class="phase-selector">
            <button class="phase-btn active" onclick="showPhase(1)">🤝 阶段1: 系统握手协商</button>
            <button class="phase-btn" onclick="showPhase(2)">⚡ 阶段2: 用户请求执行</button>
        </div>

        <div class="complete-scene">
            <!-- 阶段1: 系统握手协商 -->
            <div class="phase-container active" id="phase1">
                <div class="phase-title">🤝 阶段1: 系统启动与握手协商</div>
                <div class="conversation-flow">
                    
                    <!-- 步骤1: Host启动 -->
                    <div class="dialogue-step">
                        <div class="step-number">1</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator connecting">⚡</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble thinking-bubble">
                                    好！我启动了！让我看看配置文件...
                                    <br><br>需要连接的服务器：
                                    <br>• Dev Server (localhost:3001)
                                    <br>• Data Server (localhost:3002)  
                                    <br>• Cloud Server (cloud.api.com)
                                    <br><br>开始建立连接...
                                    <div class="emotion">🚀</div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-note">
                            🏁 <strong>启动过程</strong>: Host 读取配置文件，识别需要连接的 MCP Server 列表
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ 并发连接多个 Server ⬇️</div>

                    <!-- 步骤2: 初始连接 -->
                    <div class="dialogue-step">
                        <div class="step-number">2</div>
                        <div class="multi-server-grid">
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator connecting">⚡</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble">
                                    同时向三个服务器发起连接...
                                    <br><br>WebSocket 连接建立中...
                                    <div class="emotion">📡</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; flex-direction: column; gap: 20px;">
                                <div class="character">
                                    <div class="character-avatar dev-server-avatar">
                                        💻
                                        <div class="status-indicator connecting">⚡</div>
                                    </div>
                                    <div class="character-name">Dev Server</div>
                                    <div class="speech-bubble dev-server-bubble">
                                        收到连接请求！我是开发工具服务器，准备握手...
                                        <div class="emotion">👋</div>
                                    </div>
                                </div>
                                
                                <div class="character">
                                    <div class="character-avatar data-server-avatar">
                                        📊
                                        <div class="status-indicator connecting">⚡</div>
                                    </div>
                                    <div class="character-name">Data Server</div>
                                    <div class="speech-bubble data-server-bubble">
                                        Hello！我是数据分析服务器，建立连接中...
                                        <div class="emotion">📈</div>
                                    </div>
                                </div>
                                
                                <div class="character">
                                    <div class="character-avatar cloud-server-avatar">
                                        ☁️
                                        <div class="status-indicator connecting">⚡</div>
                                    </div>
                                    <div class="character-name">Cloud Server</div>
                                    <div class="speech-bubble cloud-server-bubble">
                                        云端服务器在线！等待协议握手...
                                        <div class="emotion">🌤️</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="connection-status">
                            <div class="server-status connecting">Dev Server: 连接中...</div>
                            <div class="server-status connecting">Data Server: 连接中...</div>
                            <div class="server-status connecting">Cloud Server: 连接中...</div>
                        </div>
                        
                        <div class="detail-note">
                            🔗 <strong>并发连接</strong>: Host 同时向多个 Server 发起 WebSocket/TCP 连接
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ MCP 协议握手开始 ⬇️</div>

                    <!-- 步骤3: 协议握手 -->
                    <div class="dialogue-step">
                        <div class="step-number">3</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator negotiating">🔄</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble">
                                    向所有 Server 发送 MCP initialize 请求！
                                    <div class="code-snippet">
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "initialize",
  "params": {
    "protocolVersion": "2024-11-05",
    "capabilities": {
      "roots": {
        "listChanged": true
      },
      "sampling": {}
    },
    "clientInfo": {
      "name": "MCP-Host",
      "version": "1.0.0"
    }
  }
}
                                    </div>
                                    <div class="emotion">📋</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar dev-server-avatar">
                                    💻
                                    <div class="status-indicator negotiating">🔄</div>
                                </div>
                                <div class="character-name">Dev Server</div>
                                <div class="speech-bubble dev-server-bubble">
                                    协议版本检查... ✅ 支持！
                                    <br>返回我的能力响应：
                                    <div class="code-snippet">
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "protocolVersion": "2024-11-05",
    "capabilities": {
      "logging": {},
      "prompts": {
        "listChanged": true
      },
      "resources": {
        "subscribe": true,
        "listChanged": true
      },
      "tools": {
        "listChanged": true
      }
    },
    "serverInfo": {
      "name": "dev-tools-server",
      "version": "1.2.0"
    }
  }
}
                                    </div>
                                    <div class="emotion">✅</div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-note">
                            🤝 <strong>协议握手</strong>: 发送 initialize 消息，协商协议版本和能力
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ 所有Server握手完成 ⬇️</div>

                    <!-- 步骤4: 能力发现 - 工具、资源、提示 -->
                    <div class="dialogue-step">
                        <div class="step-number">4</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble">
                                    太好了！现在发现所有 MCP 能力：
                                    <div class="code-snippet">
// 获取三大能力
{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "tools/list"
}

{
  "jsonrpc": "2.0", 
  "id": 3,
  "method": "resources/list"
}

{
  "jsonrpc": "2.0",
  "id": 4, 
  "method": "prompts/list"
}
                                    </div>
                                    <div class="emotion">🔍</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                            <div class="character">
                                <div class="character-avatar dev-server-avatar">
                                    💻
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">Dev Server</div>
                                <div class="speech-bubble dev-server-bubble">
                                    我的完整能力响应：
                                    <div class="code-snippet">
// tools/list Response
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "tools": [
      {
        "name": "git_commit",
        "description": "提交Git代码", 
        "inputSchema": {
          "type": "object",
          "properties": {
            "message": {"type": "string"},
            "files": {"type": "array", "items": {"type": "string"}}
          },
          "required": ["message"]
        }
      },
      {
        "name": "code_analyze", 
        "description": "代码质量分析",
        "inputSchema": {
          "type": "object", 
          "properties": {
            "repo": {"type": "string"},
            "branch": {"type": "string"}
          }
        }
      }
    ]
  }
}

// resources/list Response  
{
  "jsonrpc": "2.0",
  "id": 3,
  "result": {
    "resources": [
      {
        "uri": "project_files://structure",
        "name": "项目结构",
        "mimeType": "application/json"
      },
      {
        "uri": "git_history://commits", 
        "name": "Git提交历史",
        "mimeType": "application/json"
      }
    ]
  }
}

// prompts/list Response
{
  "jsonrpc": "2.0",
  "id": 4,
  "result": {
    "prompts": [
      {
        "name": "code_review_template",
        "description": "代码审查模板",
        "arguments": [
          {
            "name": "language",
            "description": "编程语言",
            "required": false
          }
        ]
      }
    ]
  }
}
                                    </div>
                                    <div class="emotion">🛠️</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar data-server-avatar">
                                    📊
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">Data Server</div>
                                <div class="speech-bubble data-server-bubble">
                                    我的能力响应：
                                    <div class="code-snippet">
// tools/list Response
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "tools": [
      {
        "name": "sql_query",
        "description": "执行SQL查询",
        "inputSchema": {
          "type": "object", 
          "properties": {
            "query": {"type": "string"},
            "database": {"type": "string"}
          },
          "required": ["query"]
        }
      },
      {
        "name": "generate_report",
        "description": "生成数据报告",
        "inputSchema": {
          "type": "object",
          "properties": {
            "template": {"type": "string"},
            "data": {"type": "object"}
          }
        }
      }
    ]
  }
}

// resources/list Response  
{
  "jsonrpc": "2.0",
  "id": 3,
  "result": {
    "resources": [
      {
        "uri": "database_schema://tables",
        "name": "数据库表结构",
        "mimeType": "application/json"
      },
      {
        "uri": "report_templates://quality",
        "name": "质量报告模板",
        "mimeType": "text/html"
      }
    ]
  }
}

// prompts/list Response
{
  "jsonrpc": "2.0", 
  "id": 4,
  "result": {
    "prompts": [
      {
        "name": "sql_optimization_guide", 
        "description": "SQL优化指南",
        "arguments": [
          {
            "name": "complexity",
            "description": "查询复杂度",
            "required": false
          }
        ]
      }
    ]
  }
}
                                    </div>
                                    <div class="emotion">📈</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar cloud-server-avatar">
                                    ☁️
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">Cloud Server</div>
                                <div class="speech-bubble cloud-server-bubble">
                                    云端能力响应：
                                    <div class="code-snippet">
// tools/list Response
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "tools": [
      {
        "name": "send_email",
        "description": "发送邮件",
        "inputSchema": {
          "type": "object",
          "properties": {
            "to": {"type": "array", "items": {"type": "string"}},
            "subject": {"type": "string"},
            "body": {"type": "string"},
            "attachments": {"type": "array", "items": {"type": "string"}}
          },
          "required": ["to", "subject", "body"]
        }
      },
      {
        "name": "s3_upload",
        "description": "上传文件到S3",
        "inputSchema": {
          "type": "object",
          "properties": {
            "bucket": {"type": "string"},
            "key": {"type": "string"},
            "content": {"type": "string"}
          }
        }
      }
    ]
  }
}

// resources/list Response
{
  "jsonrpc": "2.0",
  "id": 3, 
  "result": {
    "resources": [
      {
        "uri": "cloud_storage://buckets",
        "name": "云存储桶列表",
        "mimeType": "application/json"
      },
      {
        "uri": "team_contacts://directory", 
        "name": "团队通讯录",
        "mimeType": "application/json"
      }
    ]
  }
}

// prompts/list Response
{
  "jsonrpc": "2.0",
  "id": 4,
  "result": {
    "prompts": [
      {
        "name": "email_templates",
        "description": "邮件模板",
        "arguments": [
          {
            "name": "type",
            "description": "邮件类型",
            "required": true
          }
        ]
      }
    ]
  }
}
                                    </div>
                                    <div class="emotion">🌟</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-note">
                            🎯 <strong>能力发现</strong>: 获取所有 Server 的三大 MCP 能力 - Tools(工具)、Resources(资源)、Prompts(提示)
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ 系统就绪，工具注册完成 ⬇️</div>

                    <!-- 步骤5: 系统就绪 -->
                    <div class="dialogue-step">
                        <div class="step-number">5</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator done">✅</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble">
                                    完美！系统初始化完成：
                                    <br><br>✅ 3个服务器连接成功
                                    <br>✅ 协议握手完成
                                    <br>✅ 6个工具已注册
                                    <br>✅ 6个资源已发现
                                    <br>✅ 3个提示模板就绪
                                    <br>✅ 心跳监控启动
                                    <br><br>准备接受用户请求！
                                    <div class="emotion">🎉</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="connection-status">
                            <div class="server-status connected">Dev Server: 已连接 (2工具+2资源+1提示)</div>
                            <div class="server-status connected">Data Server: 已连接 (2工具+2资源+1提示)</div>
                            <div class="server-status connected">Cloud Server: 已连接 (2工具+2资源+1提示)</div>
                        </div>
                        
                        <div class="detail-note">
                            🎯 <strong>就绪状态</strong>: 所有连接建立，工具注册完成，系统进入待命状态
                        </div>
                    </div>

                </div>
            </div>

            <!-- 阶段2: 用户请求执行 -->
            <div class="phase-container" id="phase2">
                <div class="phase-title">⚡ 阶段2: 用户请求处理与执行</div>
                <div class="conversation-flow">
                    
                    <!-- 步骤1: 用户请求 -->
                    <div class="dialogue-step">
                        <div class="step-number">1</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar user-avatar">
                                    👤
                                    <div class="status-indicator thinking">💭</div>
                                </div>
                                <div class="character-name">用户</div>
                                <div class="speech-bubble user-bubble">
                                    帮我分析一下 GitHub 上我的项目代码质量，然后生成一份包含改进建议的报告，最后发邮件给我的团队
                                    <div class="emotion">🤔</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator thinking">💭</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble thinking-bubble">
                                    复杂请求检测！需要：
                                    <br>1. GitHub 代码分析
                                    <br>2. 报告生成  
                                    <br>3. 邮件发送
                                    <br><br>让我问问 AI 该怎么规划...
                                    <div class="emotion">🧠</div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-note">
                            👤 <strong>用户请求</strong>: 复杂的多步骤任务，需要协调多个工具
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ Host 调用 LLM 制定计划 ⬇️</div>

                    <!-- 步骤2: LLM 规划 -->
                    <div class="dialogue-step">
                        <div class="step-number">2</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble">
                                    AI，分析这个请求，我该用哪些MCP能力？
                                    <div class="protocol-details">
                                        <strong>可用能力:</strong><br>
                                        🔧 Tools: git_commit, code_analyze, generate_report, send_email...<br>
                                        📁 Resources: project_files://, report_templates://, team_contacts://...<br>
                                        💭 Prompts: code_review_template, email_templates...
                                    </div>
                                    <div class="emotion">❓</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar llm-avatar">
                                    🧠
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">LLM (Claude)</div>
                                <div class="speech-bubble llm-bubble">
                                    分析完成！我需要利用三种MCP能力：
                                    <br><br><strong>🔧 Tools调用计划:</strong>
                                    <br>1. Dev Server.code_analyze()
                                    <br>2. Data Server.generate_report()
                                    <br>3. Cloud Server.send_email()
                                    <br><br><strong>📁 Resources读取:</strong>
                                    <br>• project_files:// (获取代码结构)
                                    <br>• report_templates:// (报告模板)
                                    <br><br><strong>💭 Prompts使用:</strong>
                                    <br>• code_review_template (分析指导)
                                    <br>• email_templates (邮件格式)
                                    <div class="emotion">🎯</div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-note">
                            🧠 <strong>AI 规划</strong>: LLM 分析任务需求，制定使用 Tools、Resources、Prompts 的综合执行计划
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ 先获取必要的 Resources 和 Prompts ⬇️</div>

                    <!-- 步骤3: 获取资源和提示 -->
                    <div class="dialogue-step">
                        <div class="step-number">3</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble">
                                    执行前先获取必要资源和提示模板：
                                    <div class="code-snippet">
// 获取项目结构资源
{
  "jsonrpc": "2.0",
  "id": 10,
  "method": "resources/read",
  "params": {
    "uri": "project_files://structure"
  }
}

// 获取代码审查提示模板  
{
  "jsonrpc": "2.0",
  "id": 11, 
  "method": "prompts/get",
  "params": {
    "name": "code_review_template",
    "arguments": {
      "language": "javascript"
    }
  }
}

// 获取报告模板
{
  "jsonrpc": "2.0",
  "id": 12,
  "method": "resources/read", 
  "params": {
    "uri": "report_templates://quality"
  }
}
                                    </div>
                                    <div class="emotion">📋</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar dev-server-avatar">
                                    💻
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">Dev Server</div>
                                <div class="speech-bubble dev-server-bubble">
                                    提供项目资源和代码审查提示：
                                    <div class="code-snippet">
// 项目结构资源响应
{
  "jsonrpc": "2.0",
  "id": 10,
  "result": {
    "contents": [
      {
        "uri": "project_files://structure",
        "mimeType": "application/json",
        "text": "{\"src\": [\"index.js\", \"utils.js\"], \"tests\": [\"test.js\"], \"docs\": [\"README.md\"]}"
      }
    ]
  }
}

// 代码审查提示响应
{
  "jsonrpc": "2.0", 
  "id": 11,
  "result": {
    "description": "JavaScript代码审查指南",
    "prompt": "请按以下标准审查代码:\n1. 安全性检查\n2. 性能优化\n3. 代码规范\n4. 错误处理"
  }
}
                                    </div>
                                    <div class="emotion">📁</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar data-server-avatar">
                                    📊
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">Data Server</div>
                                <div class="speech-bubble data-server-bubble">
                                    提供报告模板资源：
                                    <div class="code-snippet">
// 报告模板资源响应
{
  "jsonrpc": "2.0",
  "id": 12,
  "result": {
    "contents": [
      {
        "uri": "report_templates://quality",
        "mimeType": "application/json",
        "text": "{\"title\": \"代码质量分析报告\", \"sections\": [\"执行摘要\", \"质量指标\", \"问题详情\", \"改进建议\"], \"charts\": [\"质量趋势\", \"问题分布\"]}"
      }
    ]
  }
}
                                    </div>
                                    <div class="emotion">📊</div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-note">
                            📁 <strong>资源获取</strong>: 在执行工具前，先通过 resources/read 和 prompts/get 获取必要的上下文信息
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ 开始执行工具调用 ⬇️</div>

                    <!-- 步骤4: 调用代码分析工具 -->
                    <div class="dialogue-step">
                        <div class="step-number">4</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble">
                                    Dev Server！执行代码分析任务：
                                    <div class="code-snippet">
{
  "jsonrpc": "2.0",
  "id": 100,
  "method": "tools/call",
  "params": {
    "name": "code_analyze",
    "arguments": {
      "repo": "user/my-project",
      "branch": "main"
    }
  }
}
                                    </div>
                                    <div class="emotion">📋</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar dev-server-avatar">
                                    💻
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">Dev Server</div>
                                <div class="speech-bubble dev-server-bubble">
                                    收到！基于提示模板执行分析...
                                    <br>→ 应用 code_review_template 指导
                                    <br>→ GitHub API: 拉取代码
                                    <br>→ SonarQube: 质量分析
                                    <br>→ ESLint: 代码规范
                                    <br>→ SecurityScan: 安全检查
                                    <div class="emotion">🔍</div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-note">
                            🔧 <strong>工具调用</strong>: 通过 MCP 协议调用 Dev Server 的代码分析工具
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ Dev Server 调用外部工具 ⬇️</div>

                    <!-- 步骤5: 外部工具执行 -->
                    <div class="dialogue-step">
                        <div class="step-number">5</div>
                        <div class="multi-server-grid">
                            <div class="character">
                                <div class="character-avatar dev-server-avatar">
                                    💻
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">Dev Server</div>
                                <div class="speech-bubble dev-server-bubble">
                                    同步调用多个分析工具...
                                    <br><br>⏳ 等待结果汇总...
                                    <div class="emotion">⚙️</div>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="character">
                                    <div class="character-avatar tool-avatar">
                                        🐙
                                        <div class="status-indicator working">⚡</div>
                                    </div>
                                    <div class="character-name">GitHub API</div>
                                    <div class="speech-bubble tool-bubble">
                                        代码下载完成！
                                        <br>文件：1,247个
                                        <br>大小：15.3MB
                                        <br>语言：JS, Python, CSS
                                        <div class="emotion">📦</div>
                                    </div>
                                </div>
                                
                                <div class="character">
                                    <div class="character-avatar tool-avatar">
                                        🔍
                                        <div class="status-indicator working">⚡</div>
                                    </div>
                                    <div class="character-name">SonarQube</div>
                                    <div class="speech-bubble tool-bubble">
                                        质量分析完成！
                                        <br>评分：B+ (78/100)
                                        <br>问题：3严重, 12一般
                                        <br>技术债务：2.5天
                                        <div class="emotion">📊</div>
                                    </div>
                                </div>
                                
                                <div class="character">
                                    <div class="character-avatar tool-avatar">
                                        🛡️
                                        <div class="status-indicator working">⚡</div>
                                    </div>
                                    <div class="character-name">Security Scan</div>
                                    <div class="speech-bubble tool-bubble">
                                        安全扫描完成！
                                        <br>漏洞：0高危, 2中危
                                        <br>依赖风险：3个过期包
                                        <br>总体：安全等级 Good
                                        <div class="emotion">🔒</div>
                                    </div>
                                </div>
                                
                                <div class="character">
                                    <div class="character-avatar tool-avatar">
                                        📏
                                        <div class="status-indicator working">⚡</div>
                                    </div>
                                    <div class="character-name">ESLint</div>
                                    <div class="speech-bubble tool-bubble">
                                        代码规范检查！
                                        <br>警告：8个
                                        <br>错误：0个
                                        <br>规范得分：85%
                                        <div class="emotion">✨</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-note">
                            🛠️ <strong>外部工具执行</strong>: Dev Server 实际调用 GitHub API、SonarQube 等多个外部工具
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ 分析结果返回 ⬇️</div>

                    <!-- 步骤6: 结果汇总并调用报告生成 -->
                    <div class="dialogue-step">
                        <div class="step-number">6</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar dev-server-avatar">
                                    💻
                                    <div class="status-indicator done">✅</div>
                                </div>
                                <div class="character-name">Dev Server</div>
                                <div class="speech-bubble dev-server-bubble">
                                    所有分析完成！返回结果：
                                    <div class="code-snippet">
{
  "jsonrpc": "2.0",
  "id": 100,
  "result": {
    "content": [
      {
        "type": "text",
        "text": "代码分析完成！质量评分: 78/100\n发现问题: 3个严重, 5个一般\n安全评级: Good\n建议: 增加单元测试覆盖率"
      }
    ]
  }
}
                                    </div>
                                    <div class="emotion">📊</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble">
                                    太好了！现在执行步骤2：生成报告
                                    <br><br>Data Server，用这些数据生成一份专业报告！
                                    <div class="emotion">👍</div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-note">
                            📈 <strong>结果传递</strong>: Dev Server 汇总外部工具结果，传递给 Host 进行下一步
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ 执行步骤2: 生成报告 ⬇️</div>

                    <!-- 步骤7: 报告生成 -->
                    <div class="dialogue-step">
                        <div class="step-number">7</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble">
                                    Data Server，生成专业报告：
                                    <div class="code-snippet">
{
  "jsonrpc": "2.0",
  "id": 101,
  "method": "tools/call",
  "params": {
    "name": "generate_report",
    "arguments": {
      "template": "code_quality_report",
      "data": {...analysis_result},
      "format": "html",
      "charts": true
    }
  }
}
                                    </div>
                                    <div class="emotion">📋</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar data-server-avatar">
                                    📊
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">Data Server</div>
                                <div class="speech-bubble data-server-bubble">
                                    基于模板资源生成报告...
                                    <br>→ 使用 report_templates:// 资源
                                    <br>→ Chart.js: 生成质量趋势图
                                    <br>→ Template Engine: 应用专业模板
                                    <br>→ PDF Generator: 生成 PDF 版本
                                    <br>→ 添加改进建议和行动计划
                                    <div class="emotion">📈</div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-note">
                            📊 <strong>报告生成</strong>: Data Server 调用图表库和模板引擎生成专业报告
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ 执行步骤3: 发送邮件 ⬇️</div>

                    <!-- 步骤8: 邮件发送 -->
                    <div class="dialogue-step">
                        <div class="step-number">8</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar data-server-avatar">
                                    📊
                                    <div class="status-indicator done">✅</div>
                                </div>
                                <div class="character-name">Data Server</div>
                                <div class="speech-bubble data-server-bubble">
                                    报告生成完成！包含：
                                    <br>✅ 质量评分图表
                                    <br>✅ 问题分布统计
                                    <br>✅ 改进建议清单
                                    <br>✅ 行动计划时间线
                                    <div class="emotion">📄</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble">
                                    最后一步！Cloud Server，发送邮件：
                                    <div class="code-snippet">
{
  "jsonrpc": "2.0",
  "id": 102, 
  "method": "tools/call",
  "params": {
    "name": "send_email",
    "arguments": {
      "to": ["team@company.com"],
      "subject": "项目代码质量分析报告",
      "body": "请查看附件中的详细分析报告",
      "attachments": ["quality_report.pdf"]
    }
  }
}
                                    </div>
                                    <div class="emotion">📧</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar cloud-server-avatar">
                                    ☁️
                                    <div class="status-indicator working">⚡</div>
                                </div>
                                <div class="character-name">Cloud Server</div>
                                <div class="speech-bubble cloud-server-bubble">
                                    使用邮件模板资源发送：
                                    <br>→ 应用 email_templates 格式
                                    <br>→ 通过 Office365 API 发送
                                    <br>✅ 收件人验证完成
                                    <br>✅ 报告附件上传
                                    <br>✅ 专业格式邮件发送成功！
                                    <div class="emotion">✉️</div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-note">
                            📧 <strong>邮件发送</strong>: Cloud Server 通过云端 API 将报告发送给团队
                        </div>
                    </div>

                    <div class="data-flow-arrow">⬇️ 任务完成，返回用户 ⬇️</div>

                    <!-- 步骤9: 完成响应 -->
                    <div class="dialogue-step">
                        <div class="step-number">9</div>
                        <div class="dialogue-container">
                            <div class="character">
                                <div class="character-avatar host-avatar">
                                    🏠
                                    <div class="status-indicator done">✅</div>
                                </div>
                                <div class="character-name">MCP Host</div>
                                <div class="speech-bubble host-bubble">
                                    🎉 任务完美完成！执行摘要：
                                    <br><br><strong>📁 资源使用:</strong>
                                    <br>✅ 读取项目结构和模板
                                    <br><strong>💭 提示应用:</strong>
                                    <br>✅ 应用代码审查和邮件模板
                                    <br><strong>🔧 工具执行:</strong>
                                    <br>✅ 代码质量分析：78/100分
                                    <br>✅ 生成详细改进报告
                                    <br>✅ 邮件已发送给团队
                                    <br><br>建议优先处理测试覆盖率问题
                                    <div class="emotion">🎉</div>
                                </div>
                            </div>
                            
                            <div class="character">
                                <div class="character-avatar user-avatar">
                                    👤
                                    <div class="status-indicator done">✅</div>
                                </div>
                                <div class="character-name">用户</div>
                                <div class="speech-bubble user-bubble">
                                    太棒了！你不仅分析了代码，还自动生成了专业报告并发送给团队。这正是我想要的一站式解决方案！
                                    <div class="emotion">😍</div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-note">
                            🎯 <strong>任务完成</strong>: 复杂的多步骤任务链成功完成，用户获得满意结果
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>

    <div class="timeline-controls">
        <button class="control-btn" onclick="previousPhase()">⬅️ 上个阶段</button>
        <button class="control-btn" onclick="nextPhase()">下个阶段 ➡️</button>
        <button class="control-btn" onclick="autoPlay()">▶️ 自动播放</button>
    </div>

    <script>
        let currentPhase = 1;
        let autoPlayInterval;

        function showPhase(phaseNumber) {
            // 更新按钮状态
            document.querySelectorAll('.phase-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.phase-btn:nth-child(${phaseNumber})`).classList.add('active');
            
            // 切换内容
            document.querySelectorAll('.phase-container').forEach(container => {
                container.classList.remove('active');
            });
            document.getElementById(`phase${phaseNumber}`).classList.add('active');
            
            currentPhase = phaseNumber;
        }

        function nextPhase() {
            currentPhase = currentPhase < 2 ? currentPhase + 1 : 1;
            showPhase(currentPhase);
        }

        function previousPhase() {
            currentPhase = currentPhase > 1 ? currentPhase - 1 : 2;
            showPhase(currentPhase);
        }

        function autoPlay() {
            const playBtn = document.querySelector('.timeline-controls .control-btn:last-child');
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                playBtn.textContent = '▶️ 自动播放';
            } else {
                autoPlayInterval = setInterval(nextPhase, 8000);
                playBtn.textContent = '⏸️ 暂停';
            }
        }

        // 键盘控制
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowRight') nextPhase();
            if (e.key === 'ArrowLeft') previousPhase();
            if (e.key === ' ') {
                e.preventDefault();
                autoPlay();
            }
        });
    </script>
</body>
</html>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>

  









    </main>

    <footer class="site-footer">
  <p class="site-info">
    
    &copy; 2025 YueGS
    
  </p>
</footer>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-116967169-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-116967169-1');
</script>

    
  </div>
</div>
</body>
</html>